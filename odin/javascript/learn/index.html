<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <ul id="myLibrary"></ul>
    <button id="newBook" onclick="createNewBook()">New Book</button>
    <form id="panelInput">
        <div>
            <label for="name">Book's name</label>
            <input type="text" id="name">
        </div>
        <div>
            <label for="author">Book's author</label>
            <input type="text" id="author">
        </div>
        <div>
            <label for="pages">Pages</label>
            <input type="text" id="pages">
        </div>
        <div>
            <label>Read?</label>
            <input type="radio" id="readOn" name="read" value="read">
            <label for="readOn">Read</label>
            <input type="radio" id="readOff" name="read" value="no read">
            <label for="readOff">No read</label>
        </div>
        <div>
            <button form="panelInput" type="submit" id="addBook">Add Book</button>
    </form>
    <script src="app.js"></script>
    <script>
        let myLibraryHTML = document.getElementById('myLibrary');
        //IIFE
        /**
         * функция перебора массива и отображение каждой книги в отдельной строке списка
         */
        function forEachMyLibrary() {
            myLibraryHTML.replaceChildren();
            let count = 1;
            myLibrary.forEach(elem => {
                let li = document.createElement('li');
                li.textContent = elem.info();

                let deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.setAttribute('id', count);
                deleteButton.addEventListener('click', (id) => {
                    deleteBookByLibrary(deleteButton.id - 1);
                    forEachMyLibrary();
                });
                li.appendChild(deleteButton);

                let setRead = document.createElement('button');
                setRead.textContent = 'Change status';
                setRead.setAttribute('id', count);
                setRead.addEventListener('click', (id) => {
                    changeReadStatusByBook(setRead.id - 1);
                    forEachMyLibrary();
                });
                li.appendChild(setRead);

                myLibraryHTML.appendChild(li);
                count++;
            });
        };

        forEachMyLibrary();

        let panelInput = document.getElementById('panelInput');
        panelInput.style.display = 'none';

        let newBookButton = document.getElementById('newBook');

        //newBook
        function createNewBook() {
            panelInput.style.display = 'block';
            newBookButton.style.display = 'none';
        }

        let addBookButton = document.getElementById("addBook");

        //addBook
        addBookButton.addEventListener('click', () => {
            event.preventDefault();
            //
            if (validationForm(panelInput)) {
                addBookToLibrary([panelInput.name.value, panelInput.author.value, panelInput.pages.value, panelInput.read.value]);
                forEachMyLibrary();
                //
                panelInput.style.display = 'none';
                newBookButton.style.display = 'block';
                //clear form
                clearForm();
            }
            else alert('Invalid form');

        }, false);

        const patterns = {
            'name': /^[A-ZА-Я]{1}[a-zа-я]{1,14}$/,
            'author': /^[A-ZА-Я]{1}[a-zа-я]{1,14}$/,
            'pages': /^[0-9]{1,5}$/,
            'read': /^read|no read$/
        }

        function validationForm(form) {
            for (let i = 0; i < 3; i++) {
                if (!form.elements[i].value.match(patterns[form.elements[i].id])) {
                    return false;
                }
            }
            if (!form.elements.read.value.match(patterns['read'])) {
                return false;
            }
            return true;
        }

        function clearForm() {
            panelInput.name.value = '';
            panelInput.author.value = '';
            panelInput.pages.value = '';
            panelInput.read.forEach(elem => {
                elem.checked = false;
            })
        }
    </script>
</body>

</html>